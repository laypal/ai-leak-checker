---
description: Development workflows, commands, and common tasks for the AI Leak Checker project.
globs:
alwaysApply: false
---

# Development Workflows

## Quick Reference Commands

```bash
# Development
npm run dev          # Watch mode build
npm run build        # Production build
npm run typecheck    # TypeScript check

# Testing
npm run test         # Run all tests
npm run test:unit    # Unit tests only
npm run test:e2e     # Playwright E2E
npm run test:coverage # Coverage report
npm run test:watch   # Watch mode

# Quality
npm run lint         # ESLint
npm run lint:fix     # Auto-fix lint issues
npm run format       # Prettier format
```

## Adding a New Detector

1. **Define type** in `src/shared/types/detection.ts`:
   ```typescript
   API_KEY_NEW_SERVICE: 'api_key_new_service',
   ```

2. **Add pattern** in `src/shared/detectors/patterns.ts`:
   ```typescript
   {
     type: DetectorType.API_KEY_NEW_SERVICE,
     pattern: /prefix_[a-zA-Z0-9]{32}/g,
     confidence: 0.9,
   }
   ```

3. **Add tests** in `tests/unit/patterns.test.ts`

4. **Add fixtures** in `tests/fixtures/api_keys.json`

5. **Run tests**: `npm run test:unit`

## Adding a New AI Platform

1. **Add selectors** to `configs/selectors.json`:
   ```json
   {
     "newplatform.com": {
       "textarea": ["#input", ".editor"],
       "submitButton": ["button[type=submit]"],
       "version": 1
     }
   }
   ```

2. **Add host permission** to `public/manifest.json`:
   ```json
   "host_permissions": [
     "https://newplatform.com/*"
   ]
   ```

3. **Add content script match**:
   ```json
   "content_scripts": [{
     "matches": ["https://newplatform.com/*"],
     "js": ["content/index.js"]
   }]
   ```

4. **Add E2E test** in `tests/e2e/newplatform.spec.ts`

## Updating Selectors (When Site Changes)

1. Inspect the site's current DOM
2. Update `configs/selectors.json`
3. Increment the `version` number
4. Run E2E tests: `npm run test:e2e`
5. If using remote config, update CDN

## Release Checklist

```markdown
- [ ] Version bump in `manifest.json`
- [ ] Version bump in `package.json`
- [ ] Update CHANGELOG.md
- [ ] Run `npm run lint`
- [ ] Run `npm run typecheck`
- [ ] Run `npm run test`
- [ ] Run `npm run build`
- [ ] Manual smoke test in Chrome
- [ ] Create git tag
- [ ] Upload to Chrome Web Store
```

## Git Workflow

### Commit Messages

```
feat(detection): add AWS Secret Access Key pattern
fix(dom): handle ProseMirror contenteditable
test(entropy): add property tests for edge cases
docs(readme): update installation instructions
chore(deps): update vitest to 1.2.0
```

### Branch Naming

```
feature/add-slack-token-detection
fix/chatgpt-selector-update
test/add-e2e-coverage
```

## Debugging Tips

### Content Script Not Loading

1. Check `manifest.json` matches patterns
2. Verify host permissions
3. Check for CSP errors in console
4. Try `chrome://extensions` â†’ Reload

### Detection Not Working

1. Add `console.log` in detection engine
2. Check if text is reaching `scan()`
3. Verify regex patterns with regex101.com
4. Check entropy thresholds

### Service Worker Issues

1. Check for syntax errors (kills SW)
2. Inspect via `chrome://extensions`
3. Add error handling to all async code
4. Remember SW is ephemeral - use storage

## File Size Monitoring

Keep files under limits:

```bash
# Check file sizes
find src -name "*.ts" -exec wc -l {} + | sort -n

# Files over 400 lines need splitting
```
